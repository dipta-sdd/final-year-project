<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Upload, Preview, and Cropping</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css"
    />
    <style>
      /* No dedicated styling for the cropper-container since it's dynamically sized */
    </style>
  </head>
  <body>
    <label for="imageUpload">Upload an Image:</label>
    <input type="file" id="imageUpload" accept="image/*" />
    <img
      id="imagePreview"
      src="#"
      alt="Image Preview"
      style="max-width: 200px; display: none"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>
      const imageInput = document.getElementById("imageUpload");
      const imagePreview = document.getElementById("imagePreview");
      let cropper;

      imageInput.addEventListener("change", function () {
        const file = this.files[0];

        if (file) {
          const reader = new FileReader();

          reader.addEventListener("load", function () {
            imagePreview.src = this.result;
            imagePreview.style.display = "block";

            // Create Cropper Container dynamically
            const cropperContainer = document.createElement("div");
            cropperContainer.style.maxWidth = imagePreview.width + "px";
            imagePreview.parentNode.insertBefore(
              cropperContainer,
              imagePreview.nextSibling
            );

            // Initialize Cropper.js
            const image = imagePreview;
            cropper = new Cropper(image, {
              aspectRatio: 1,
              viewMode: 1,
              autoCropArea: 0.8,
            });
          });

          reader.readAsDataURL(file);
        }
      });

      // Example - Getting cropped image data for further actions
      function getCroppedImage() {
        if (cropper) {
          const croppedImage = cropper
            .getCroppedCanvas()
            .toDataURL("image/jpeg");
          console.log(croppedImage); // Do something with the cropped image data (e.g., upload)
        }
      }
    </script>
  </body>
</html>
